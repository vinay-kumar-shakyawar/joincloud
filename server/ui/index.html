<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JoinCloud</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <button class="button secondary menu-toggle" id="menu-toggle" aria-label="Toggle navigation">☰</button>
        <img class="brand-logo" src="/logo.png" alt="JoinCloud" />
        <span>JoinCloud</span>
        <span class="badge" id="pending-badge" style="display:none">0 Pending</span>
        <span class="brand-separator">|</span>
        <span class="brand-user" id="header-display-name">Join</span>
      </div>
      <div class="header-actions">
        <button class="button secondary" id="add-file-header">Add File</button>
        <button class="button secondary" id="toggle-sharing">Stop</button>
        <div class="value value-muted" id="upload-destination-label"></div>
        <div class="status" id="node-status"><span class="status-dot running" id="status-dot"></span> Status: Running</div>
      </div>
    </header>

    <div class="grace-banner" id="grace-banner" style="display:none;" role="alert">
      <span id="grace-banner-text">Payment issue – please update your payment method. Full access until <span id="grace-ends-date"></span>.</span>
      <a id="grace-banner-upgrade" href="#" target="_blank" rel="noopener noreferrer" style="margin-left:12px; color:inherit; font-weight:600; text-decoration:underline; display:none;">Upgrade now</a>
    </div>

    <section class="layout" id="access-gate" style="display:none;">
      <div class="content">
        <section class="card access-card">
          <h2>Request Access</h2>
          <div class="value">This device needs admin approval before it can access JoinCloud.</div>
          <div class="row" style="margin-top:12px">
            <div style="flex:1">
              <div class="label">Device</div>
              <input class="input mono" id="access-device-name-input" maxlength="48" placeholder="Enter device name" />
            </div>
            <div style="flex:1">
              <div class="label">Fingerprint</div>
              <div class="value mono" id="access-fingerprint">--</div>
            </div>
          </div>
          <div class="row" style="margin-top:16px">
            <button class="button" id="request-approval">Request Approval</button>
          </div>
          <div class="value value-muted" id="access-status" style="margin-top:12px">Waiting to request access.</div>
        </section>
      </div>
    </section>

    <section class="layout" id="activation-gate" style="display:none;">
      <div class="content">
        <section class="card access-card" style="max-width:440px; margin:0 auto; text-align:center;">
          <div style="margin-bottom:16px;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.7"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          </div>
          <h2 style="margin:0 0 8px">Sign in to JoinCloud</h2>
          <p class="value value-muted" style="margin:0 0 24px; line-height:1.5;">A free 7-day trial starts automatically when you sign in.<br>No credit card required.</p>
          <button class="button" id="activation-gate-signin-web" style="width:100%; padding:12px 0; font-size:15px;">Sign In / Create Account</button>
          <div id="activation-gate-message" class="modal-result" style="margin-top:12px;"></div>
          <p class="value value-muted" style="margin-top:20px; font-size:12px; line-height:1.4;">Your browser will open to sign in or create an account.<br>You'll be redirected back here automatically.</p>
          <p id="activation-gate-upgrade-wrap" style="display:none; margin-top:12px;">
            <a id="activation-gate-upgrade-link" class="link" href="#" target="_blank" rel="noopener noreferrer">View plans &amp; pricing</a>
          </p>
        </section>
      </div>
    </section>

    <main class="layout" id="app-layout" style="display:none;">
      <aside class="sidebar">
        <button class="nav-button active" data-section="home">Home</button>
        <button class="nav-button" data-section="files">Files</button>
        <button class="nav-button" data-section="shares">Shares</button>
        <button class="nav-button" data-section="logs">Logs</button>
        <button class="nav-button" data-section="settings">Settings</button>
        <button class="nav-button" data-section="devices">Devices</button>
        <button class="nav-button" data-section="activity">Activity</button>
        <button class="nav-button" data-section="network">Network</button>
        <button class="nav-button" data-section="support">Support</button>
      </aside>

      <div class="content">
      <section class="card section" data-section="home">
        <h2>Home</h2>
        <div class="row">
          <div>
            <div class="label">Storage</div>
            <div class="value" id="storage-label">Local storage</div>
          </div>
          <div>
            <div class="label">WebDAV Mount</div>
            <div class="value mono" id="owner-mount">--</div>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="button secondary" id="open-storage">Open Storage Folder</button>
        </div>
        <div class="row space-between" style="margin-top:16px">
          <div>
            <div class="label">Public Access</div>
            <div class="value" id="public-status">Coming Soon</div>
            <div class="value" id="public-reason">Public access is coming soon.</div>
          </div>
        </div>
        <div class="row cloud-url-section" style="margin-top:18px">
          <div style="flex:1">
            <div class="label">Cloud URL</div>
            <input class="input mono" id="cloud-url-input" readonly />
            <div class="row" style="margin-top:10px">
              <button class="button secondary" id="copy-cloud-url">Copy</button>
            </div>
            <div class="qr-wrap">
              <canvas id="cloud-url-qr" width="220" height="220"></canvas>
            </div>
          </div>
        </div>
        <div class="row" style="margin-top:18px">
          <div style="width:100%">
            <div class="label">Pending Access Requests <span class="badge" id="pending-access-count">0</span></div>
            <div class="pending-list" id="pending-access-list"></div>
          </div>
        </div>
        <div class="row" style="margin-top:18px">
          <div style="width:100%">
            <div class="label">Share Page Visits</div>
            <div class="value" id="share-visit-total">Total: 0</div>
            <div class="value value-muted" id="share-visit-today">Today: 0</div>
          </div>
        </div>
      </section>

      <section class="card section" data-section="files">
        <div class="row space-between">
          <h2>File Browser</h2>
          <div class="row">
            <label class="button secondary" id="upload-button-label" for="upload-input">Upload</label>
            <input id="upload-input" type="file" multiple hidden />
            <button class="button secondary" id="my-folder-shortcut" style="display:none">My Folder</button>
            <button class="button secondary" id="back-button">Back</button>
            <button class="button secondary" id="refresh-files">Refresh</button>
          </div>
        </div>
        <div class="file-controls">
          <input class="input" id="file-search" placeholder="Search in current folder" />
          <select class="input" id="file-sort">
            <option value="name_asc">Name (A-Z)</option>
            <option value="name_desc">Name (Z-A)</option>
            <option value="modified_desc">Date Modified (Newest)</option>
            <option value="modified_asc">Date Modified (Oldest)</option>
            <option value="ext_asc">Extension (A-Z)</option>
            <option value="ext_desc">Extension (Z-A)</option>
          </select>
          <label class="toggle">
            <input type="checkbox" id="folders-only" />
            <span>Folders only</span>
          </label>
          <div class="view-toggle" role="group" aria-label="File view mode">
            <button class="button secondary active" id="view-list">List</button>
            <button class="button secondary" id="view-thumb">Thumbnails</button>
          </div>
        </div>
        <div class="drop-zone" id="drop-zone">Drag & drop files here</div>
        <div class="value value-muted" id="upload-scope-hint"></div>
        <div class="breadcrumbs" id="breadcrumbs"></div>
        <div class="file-list" id="file-list" data-view="list"></div>
      </section>

      <section class="card section" data-section="shares">
        <div class="row space-between">
          <h2>Active Shares</h2>
          <div class="row">
            <button class="button secondary" id="revoke-selected" disabled>Revoke Selected</button>
            <button class="button danger" id="revoke-all">Revoke All</button>
            <button class="button secondary" id="refresh-shares">Refresh</button>
          </div>
        </div>
        <div class="share-list" id="share-list"></div>
      </section>
      
      <section class="card section" data-section="logs">
        <div class="row space-between">
          <h2>Logs</h2>
          <button class="button secondary" id="refresh-logs">Refresh</button>
        </div>
        <div class="log-list" id="log-list"></div>
      </section>

      <section class="card section" data-section="settings">
        <h2>Settings</h2>
        <!-- Rich profile card (shown when a license is active) -->
        <div id="settings-profile-card" style="display:none; background:var(--surface-2,#f6f8fa); border:1px solid var(--border,#e2e8f0); border-radius:10px; padding:16px 18px; margin-bottom:18px;">
          <div style="display:flex; align-items:center; gap:14px; flex-wrap:wrap;">
            <div style="width:40px;height:40px;border-radius:50%;background:var(--accent,#3b82f6);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
            </div>
            <div style="flex:1;min-width:160px;">
              <div id="settings-profile-email" style="font-size:14px;font-weight:600;color:var(--fg,#1a202c);word-break:break-all;">—</div>
              <div style="margin-top:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                <span style="font-size:12px;color:var(--muted,#888);">Plan:</span>
                <span id="settings-profile-plan" style="font-size:12px;font-weight:600;color:var(--fg,#1a202c);">—</span>
                <span id="settings-profile-status" class="settings-profile-badge">—</span>
              </div>
              <div style="margin-top:6px;display:flex;gap:16px;flex-wrap:wrap;">
                <div>
                  <span style="font-size:11px;color:var(--muted,#888);">Device limit: </span>
                  <span id="settings-profile-device-limit" style="font-size:11px;font-weight:600;">—</span>
                </div>
                <div>
                  <span style="font-size:11px;color:var(--muted,#888);">Expires: </span>
                  <span id="settings-profile-expiry" style="font-size:11px;font-weight:600;">—</span>
                </div>
              </div>
            </div>
            <div>
              <a id="settings-open-dashboard-link" class="button" href="#" target="_blank" rel="noopener noreferrer" style="font-size:12px;padding:6px 12px;text-decoration:none;display:inline-block;">Open Dashboard</a>
            </div>
          </div>
        </div>
        <!-- Legacy profile row (hidden when rich card is shown) -->
        <div class="profile-row" id="settings-profile-row" style="display:none; margin-bottom: 16px; padding: 12px 0; border-bottom: 1px solid var(--border, #e2e8f0);">
          <div class="label" style="font-size: 11px; text-transform: uppercase; letter-spacing: .05em; color: var(--muted, #888);">Profile</div>
          <div class="value" id="settings-profile-value">—</div>
        </div>
        <div class="subscription-card" id="subscription-card" style="display:none;">
          <h3 class="subscription-title">Subscription &amp; Billing</h3>
          <div class="row" style="margin-top:8px">
            <div class="label">Plan</div>
            <div class="value" id="subscription-plan">—</div>
          </div>
          <div class="row" style="margin-top:8px">
            <div class="label">Status</div>
            <div class="value" id="subscription-status">—</div>
          </div>
          <div class="row" style="margin-top:8px">
            <div class="label">Renewal date</div>
            <div class="value" id="subscription-renewal">—</div>
          </div>
          <div class="row" style="margin-top:12px; gap: 12px;">
            <button class="button" id="subscription-manage-btn" style="display:none;">Manage subscription / Payment</button>
            <a id="subscription-upgrade-link" class="link" href="#" target="_blank" rel="noopener noreferrer" style="display:none;">Upgrade / Buy plan</a>
            <a id="subscription-open-dashboard-link" class="link" href="#" target="_blank" rel="noopener noreferrer" style="display:none;">Open Dashboard</a>
          </div>
          <div class="value value-muted" style="margin-top:8px; font-size: 12px;">Payment and subscription are managed securely. Use &quot;Manage subscription&quot; to update payment method or cancel. View past payments on the web dashboard.</div>
        </div>
        <div class="row" style="margin-top:18px;">
          <button class="button secondary" id="settings-logout" type="button">Sign out</button>
        </div>
        <div class="row space-between" style="margin-top:18px">
          <div>
            <div class="label">Operational Telemetry</div>
            <div class="value">Anonymous, aggregated usage metrics</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="telemetry-toggle" />
            <span>Enabled</span>
          </label>
        </div>
        <div class="row" style="margin-top:18px">
          <div style="flex:1">
            <div class="label">Privacy Policy</div>
            <div class="row" style="margin-top:8px">
              <button class="button secondary" id="copy-privacy-policy">Copy</button>
              <button class="button secondary" id="download-privacy-policy">Download</button>
            </div>
            <div class="privacy-policy-content" id="privacy-policy-content"></div>
          </div>
        </div>
        <div class="row" style="margin-top:24px">
          <div style="flex:1">
            <div class="label">Name</div>
            <div class="name-input-group">
              <input class="input name-prefix" value="Join" disabled />
              <input class="input name-suffix" id="network-name-suffix" maxlength="32" placeholder="Your name" />
            </div>
          </div>
          <button class="button secondary" id="save-network-name">Save</button>
        </div>
        <div class="row space-between" style="margin-top:16px">
          <div>
            <div class="label">Network Visibility</div>
            <div class="value">Coming Soon</div>
            <div class="value value-muted">Network visibility is coming soon.</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="network-visibility" disabled />
            <span>Coming Soon</span>
          </label>
        </div>
        <div class="row" style="margin-top:8px">
          <div class="value">
            What is shared on the network? Only your chosen display name and online status are visible to other JoinCloud users on the same network. No files, device details, or identifiers are ever shared automatically.
          </div>
        </div>
      </section>

      <section class="card section" data-section="network">
        <div class="row space-between">
          <h2>Network</h2>
        </div>
        <div class="value">Coming Soon</div>
        <div class="row space-between" style="margin-top:16px">
          <div>
            <div class="label">Network Visibility</div>
            <div class="value">Coming Soon</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="network-visibility-network" disabled />
            <span>Coming Soon</span>
          </label>
        </div>
        <div class="network-list" id="network-list"></div>
      </section>

      <section class="card section" data-section="devices">
        <div class="row space-between">
          <h2>Devices</h2>
          <button class="button secondary" id="refresh-devices">Refresh</button>
        </div>
        <div class="value value-muted">Approved devices can access JoinCloud after admin approval.</div>
        <div class="pending-list" id="approved-devices-list" style="margin-top:12px"></div>
      </section>

      <section class="card section" data-section="activity">
        <div class="row space-between">
          <h2>Activity Dashboard</h2>
          <button class="button secondary" id="refresh-activity">Refresh</button>
        </div>
        <div class="activity-grid" id="activity-metrics">
          <div class="metric-card">
            <div class="metric-label">Total Uploads</div>
            <div class="metric-value" id="metric-total-uploads">0</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Total Downloads</div>
            <div class="metric-value" id="metric-total-downloads">0</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Shares Created</div>
            <div class="metric-value" id="metric-shares-created">0</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Connected Devices</div>
            <div class="metric-value" id="metric-connected-devices">0</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Storage Used</div>
            <div class="metric-value" id="metric-storage-used">0 B</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Share Downloads</div>
            <div class="metric-value" id="metric-share-downloads">0</div>
          </div>
        </div>
        <div class="value value-muted" id="activity-summary" style="margin-top:12px">Loading activity...</div>
        <div class="activity-chart-wrap">
          <canvas id="activity-chart" height="180"></canvas>
        </div>
      </section>

      <section class="card section" data-section="support">
        <h2>Support</h2>
        <p class="value value-muted">Chat with your admin. Messages sync with the control panel.</p>
        <div class="support-chat">
          <div class="support-messages" id="support-messages"></div>
          <div class="support-send-row">
            <input class="input" id="support-message-input" type="text" placeholder="Type a message..." maxlength="2000" />
            <button class="button" id="support-send">Send</button>
          </div>
        </div>
      </section>
      </div>
    </main>

    <div class="modal" id="share-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create Share</h3>
          <button class="button ghost" id="close-modal">✕</button>
        </div>
        <div class="modal-body">
          <div id="activation-block" class="activation-block" style="display:none">
            <p class="value value-muted">Sign in once to link this device to your account. You can then create shares and use all features without signing in again.</p>
            <div class="activation-actions">
              <button class="button" id="activation-signin-web">Sign In / Create Account</button>
            </div>
            <p class="value value-muted" style="margin-top:8px;font-size:12px;">Opens the JoinCloud website in your browser. You'll be redirected back here automatically.</p>
            <div id="activation-message" class="modal-result"></div>
            <p class="activation-upgrade-wrap" id="activation-upgrade-wrap" style="display:none; margin-top: 12px;">
              <a id="activation-upgrade-link" class="link" href="#" target="_blank" rel="noopener noreferrer">Upgrade / Buy plan</a>
            </p>
          </div>
          <label class="label">Path</label>
          <input class="input mono" id="share-path" readonly />

          <label class="label">Share Scope</label>
          <div class="radio-group">
            <label><input type="radio" name="share-scope" value="local" checked /> Local</label>
            <label><input type="radio" name="share-scope" value="public" disabled /> Public (Coming Soon)</label>
          </div>

          <label class="label">Permission</label>
          <select class="input" id="share-permission">
            <option value="read-only">Read-only</option>
            <option value="read-write">Read-write</option>
          </select>

          <label class="label">Expiry</label>
          <select class="input" id="share-ttl">
            <option value="3600000">1 hour</option>
            <option value="21600000">6 hours</option>
            <option value="86400000" selected>24 hours</option>
            <option value="604800000">7 days</option>
            <option value="custom">Custom (minutes)</option>
          </select>
          <input class="input" id="share-ttl-custom" type="number" min="1" placeholder="Enter minutes" />
        </div>
        <div class="modal-actions">
          <button class="button secondary" id="cancel-share">Cancel</button>
          <button class="button" id="create-share">Create Share</button>
        </div>
        <div class="modal-result" id="share-result"></div>
        <button class="button secondary" id="copy-share" style="display:none">Copy Link</button>
      </div>
    </div>

    <div class="modal" id="sharing-stop-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Stop JoinCloud</h3>
          <button class="button ghost" id="close-stop-modal">✕</button>
        </div>
        <div class="modal-body">
          <div class="value">Choose what you want to do:</div>
          <div class="value value-muted">Stopping sharing keeps the app open for local control.</div>
        </div>
        <div class="modal-actions">
          <button class="button secondary" id="cancel-stop-modal">Cancel</button>
          <button class="button secondary" id="stop-sharing-only">Stop Sharing</button>
          <button class="button danger" id="close-application">Close Application</button>
        </div>
      </div>
    </div>

    <div class="modal" id="preview-modal">
      <div class="modal-content preview-content">
        <div class="modal-header">
          <h3 id="preview-title">Preview</h3>
          <button class="button ghost" id="close-preview-modal">✕</button>
        </div>
        <div class="preview-body" id="preview-body"></div>
      </div>
    </div>

    <footer class="build-footer" id="build-id">BUILD: loading...</footer>

    <script src="/vendor/qrious.min.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
